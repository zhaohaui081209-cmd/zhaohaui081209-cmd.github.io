<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>志愿服务签到系统</title>
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 512' width='32' height='32'%3E%3Cpath fill='%23FF0000' d='M64 64c0-35.3 28.7-64 64-64h384c35.3 0 64 28.7 64 64v384c0 35.3-28.7 64-64 64H128c-35.3 0-64-28.7-64-64V64zm64 32v320h384V96H128zm0 0h384 0H128z'/%3E%3Cpath fill='%23FFD700' d='M192 128h256v256H192z'/%3E%3Cpath fill='%23000080' d='M224 160h192v192H224z'/%3E%3C/svg%3E" type="image/svg+xml">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/leancloud-storage@4.15.1/dist/av-min.js"></script>
</head>
<body>
    <!-- 登录页面 -->
    <div id="loginPage" class="login-page">
        <div class="login-container">
            <div class="login-header">
                <div class="logo">
                    <i class="fas fa-users"></i>
                </div>
                <h1>志愿服务签到系统</h1>
                <p class="subtitle">团员入团志愿服务管理</p>
            </div>
            <div class="login-form">
                <div class="form-group">
                    <label for="username">用户名</label>
                    <div class="input-wrapper">
                        <i class="fas fa-user"></i>
                        <input type="text" id="username" class="form-control" placeholder="请输入用户名">
                    </div>
                </div>
                <div class="form-group">
                    <label for="password">密码</label>
                    <div class="input-wrapper">
                        <i class="fas fa-lock"></i>
                        <input type="password" id="password" class="form-control" placeholder="请输入密码">
                        <button class="toggle-password" onclick="togglePassword()">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>
                <button class="btn btn-primary btn-block" onclick="handleLogin()">
                    <i class="fas fa-sign-in-alt"></i> 登录
                </button>
            </div>
        </div>
        <div class="login-bg">
            <div class="bg-shape shape-1"></div>
            <div class="bg-shape shape-2"></div>
            <div class="bg-shape shape-3"></div>
        </div>
    </div>

    <div class="container">
        <!-- 头部 -->
        <header class="header">
            <div class="header-content">
                <h1><i class="fas fa-users"></i> 志愿服务签到系统</h1>
                <p class="subtitle">团员入团志愿服务管理</p>
            </div>
            <div class="header-actions">
                <button class="btn btn-primary" onclick="openModal('changePasswordModal')">
                    <i class="fas fa-key"></i> 修改密码
                </button>
                <button class="btn btn-secondary" onclick="handleLogout()">
                    <i class="fas fa-sign-out-alt"></i> 登出
                </button>
            </div>
        </header>

        <!-- 主内容区 -->
        <main class="main-content">
            <!-- 导航标签 -->
            <div class="nav-tabs">
                <button class="nav-tab active" data-tab="groups">
                    <i class="fas fa-layer-group"></i> 分组管理
                </button>
                <button class="nav-tab" data-tab="import">
                    <i class="fas fa-file-import"></i> 成员导入
                </button>
                <button class="nav-tab" data-tab="signin">
                    <i class="fas fa-check-circle"></i> 签到管理
                </button>
                <button class="nav-tab" data-tab="summary">
                    <i class="fas fa-chart-bar"></i> 总结统计
                </button>
            </div>

            <!-- 标签内容 -->
            <div class="tab-content">
                <!-- 分组管理 -->
                <div id="groups" class="tab-panel active">
                    <div class="card">
                        <div class="card-header">
                            <h2>分组管理</h2>
                            <button class="btn btn-primary" onclick="openCreateGroupModal()">
                                <i class="fas fa-plus"></i> 创建分组
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="groups-grid" id="groupsGrid">
                                <!-- 分组卡片将动态生成 -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 成员导入 -->
                <div id="import" class="tab-panel">
                    <div class="card">
                        <div class="card-header">
                            <h2>成员导入</h2>
                        </div>
                        <div class="card-body">
                            <div class="import-section">
                                <div class="form-group">
                                    <label for="importFile">导入Excel/CSV文件</label>
                                    <div class="file-input-wrapper">
                                        <input type="file" id="importFile" accept=".xlsx,.xls,.csv" class="file-input">
                                        <span class="file-input-text">选择文件</span>
                                    </div>
                                </div>
                                <div class="import-info">
                                    <p><strong>文件格式要求：</strong>包含姓名、班级、分组等信息。系统会自动识别"分组"列，并为不存在的分组自动创建。</p>
                                    <button class="btn btn-secondary" onclick="downloadTemplate()">
                                        <i class="fas fa-download"></i> 下载模板
                                    </button>
                                </div>
                                <button class="btn btn-primary" onclick="importMembers()">
                                    <i class="fas fa-upload"></i> 开始导入
                                </button>
                                <button class="btn btn-success" onclick="openModal('addMemberModal')" style="margin-left: 10px;">
                                    <i class="fas fa-user-plus"></i> 添加单个成员
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 签到管理 -->
                <div id="signin" class="tab-panel">
                    <div class="card">
                        <div class="card-header">
                            <h2>签到管理</h2>
                            <div class="signin-controls">
                                <select id="signinGroupSelect" class="form-control">
                                    <!-- 分组选项将动态生成 -->
                                </select>
                                <button class="btn btn-success" onclick="signInAll()">
                                    <i class="fas fa-check-double"></i> 全部签到
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="signin-type-tabs">
                                <button class="signin-type-tab active" data-signin-type="morning">
                                    <i class="fas fa-sun"></i> 上午签到
                                </button>
                                <button class="signin-type-tab" data-signin-type="afternoon">
                                    <i class="fas fa-cloud-sun"></i> 下午签到
                                </button>
                                <button class="signin-type-tab" data-signin-type="evening">
                                    <i class="fas fa-moon"></i> 晚上签到
                                </button>
                            </div>
                            <div class="signin-table-container">
                                <table class="signin-table">
                                    <thead>
                                        <tr>
                                            <th>序号</th>
                                            <th>姓名</th>
                                            <th>学号</th>
                                            <th>班级</th>
                                            <th>签到状态</th>
                                            <th>签到时间</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody id="signinTableBody">
                                        <!-- 签到表格内容将动态生成 -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 总结统计 -->
                <div id="summary" class="tab-panel">
                    <div class="card">
                        <div class="card-header">
                            <h2>总结统计</h2>
                        </div>
                        <div class="card-body">
                            <div class="summary-filters">
                                <div class="form-group">
                                    <label for="summaryGroupSelect">选择分组</label>
                                    <select id="summaryGroupSelect" class="form-control">
                                        <!-- 分组选项将动态生成 -->
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="startDate">开始日期</label>
                                    <input type="date" id="startDate" class="form-control">
                                </div>
                                <div class="form-group">
                                    <label for="endDate">结束日期</label>
                                    <input type="date" id="endDate" class="form-control">
                                </div>
                                <button class="btn btn-primary" onclick="generateSummary()">
                                    <i class="fas fa-search"></i> 生成总结
                                </button>
                            </div>

                            <div class="summary-stats" id="summaryStats">
                                <!-- 统计数据将动态生成 -->
                            </div>

                            <div class="summary-table-container" id="summaryTableContainer">
                                <!-- 总结表格将动态生成 -->
                            </div>

                            <div class="summary-export" id="summaryExport" style="display: none;">
                                <button class="btn btn-success" onclick="exportSummary()">
                                    <i class="fas fa-file-export"></i> 导出总结表格
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- 创建分组模态框 -->
    <div id="createGroupModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>创建分组</h3>
                <button class="close-btn" onclick="closeModal('createGroupModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="groupName">分组名称</label>
                    <input type="text" id="groupName" class="form-control" placeholder="请输入分组名称">
                </div>
                <div class="form-group">
                    <label for="groupDescription">分组描述</label>
                    <textarea id="groupDescription" class="form-control" placeholder="请输入分组描述" rows="3"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('createGroupModal')">取消</button>
                <button class="btn btn-primary" onclick="createGroup()">创建</button>
            </div>
        </div>
    </div>

    <!-- 编辑分组模态框 -->
    <div id="editGroupModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>编辑分组</h3>
                <button class="close-btn" onclick="closeModal('editGroupModal')">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="editGroupId">
                <div class="form-group">
                    <label for="editGroupName">分组名称</label>
                    <input type="text" id="editGroupName" class="form-control">
                </div>
                <div class="form-group">
                    <label for="editGroupDescription">分组描述</label>
                    <textarea id="editGroupDescription" class="form-control" rows="3"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('editGroupModal')">取消</button>
                <button class="btn btn-primary" onclick="updateGroup()">保存</button>
            </div>
        </div>
    </div>

    <!-- 添加单个成员模态框 -->
    <div id="addMemberModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>添加单个成员</h3>
                <button class="close-btn" onclick="closeModal('addMemberModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="addMemberGroupName">选择分组</label>
                    <select id="addMemberGroupName" class="form-control">
                        <!-- 分组选项将动态生成 -->
                    </select>
                </div>
                <div class="form-group">
                    <label for="addMemberName">姓名</label>
                    <input type="text" id="addMemberName" class="form-control" placeholder="请输入姓名">
                </div>
                <div class="form-group">
                    <label for="addMemberStudentId">学号</label>
                    <input type="text" id="addMemberStudentId" class="form-control" placeholder="请输入学号">
                </div>
                <div class="form-group">
                    <label for="addMemberGender">性别</label>
                    <select id="addMemberGender" class="form-control">
                        <option value="">请选择性别</option>
                        <option value="男">男</option>
                        <option value="女">女</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="addMemberClass">班级</label>
                    <input type="text" id="addMemberClass" class="form-control" placeholder="请输入班级">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('addMemberModal')">取消</button>
                <button class="btn btn-primary" onclick="addSingleMember()">添加</button>
            </div>
        </div>
    </div>
    
    <!-- 修改密码模态框 -->
    <div id="changePasswordModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>修改密码</h3>
                <button class="close-btn" onclick="closeModal('changePasswordModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="currentPassword">当前密码</label>
                    <div class="input-wrapper">
                        <i class="fas fa-lock"></i>
                        <input type="password" id="currentPassword" class="form-control" placeholder="请输入当前密码">
                    </div>
                </div>
                <div class="form-group">
                    <label for="newPassword">新密码</label>
                    <div class="input-wrapper">
                        <i class="fas fa-lock"></i>
                        <input type="password" id="newPassword" class="form-control" placeholder="请输入新密码">
                    </div>
                </div>
                <div class="form-group">
                    <label for="confirmPassword">确认新密码</label>
                    <div class="input-wrapper">
                        <i class="fas fa-lock"></i>
                        <input type="password" id="confirmPassword" class="form-control" placeholder="请确认新密码">
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('changePasswordModal')">取消</button>
                <button class="btn btn-primary" onclick="changePassword()">保存</button>
            </div>
        </div>
    </div>

    <!-- 消息通知 -->
    <div id="message" class="message"></div>

    <!-- 1. 操作记录展示容器（ID：operation-list，和JS对应，用于显示同步后的记录） -->
    <div id="operation-list" style="margin: 20px 0;"></div>

    <!-- 2. 你的操作按钮（ID：my-operation-btn，和JS对应，点击后记录操作） -->
    <!-- 保留你原有按钮的样式，只需添加这个ID即可 -->
    <button id="my-operation-btn" style="padding: 8px 16px; cursor: pointer;">
        我的操作（点击记录）
    </button>

    <script src="script.js"></script>
</body>
</html>